---
title: "Data_Cleanup"
author: "Sara Knight"
date: "7/17/2023"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r loading_library}

library(tidyverse)
library(tidymodels)
library(stringr)

```


```{r loading_data}

books<- read_csv("~/STA_631/Projects/book_ban_project/data/Book_Challenge_Data.csv")
books2<- read_csv("~/STA_631/Projects/book_ban_project/data/df_books.csv")

```

Got rid of all of the books that had no Goodreads tags.

```{r}

books <- books %>% drop_na(Book_Tag)

```


Cleaned up the string of booktags
```{r}

books$Book_Tag <- str_to_title(books$Book_Tag)

```

Got rid of all the white space between the words to help fix some of the human errors
```{r}

books$Book_Tag <-gsub(" ", "", books$Book_Tag, fixed = TRUE)

```



Separated the book tags for the challenged books into their own individual columns.
```{r}

test <-books %>% 
   separate(Book_Tag,c("Book_Tag1","Book_Tag2", "Book_Tag3", "Book_Tag4",
                       "Book_Tag5", "Book_Tag6", "Book_Tag7",
                       "Book_Tag8","Book_Tag9"),sep=",")

```

Made a data set of just tags so that I could see how frequently the tags showed up
```{r}
tags <- test[,c(3:11)]
```


```{r}
count <- table(unlist(tags))
```

```{r}
count <- as.data.frame(count)
```

order them so I could see what was the highest and lowest
```{r}

count <- count[order(count$Freq),]

```

Did the same for the other book tag
```{r}

books2$Book_Tag <- str_to_title(books2$Book_Tag)

```

```{r}

books2$Book_Tag <-gsub(" ", "", books2$Book_Tag, fixed = TRUE)

```

```{r}

books2 <-books2  %>% 
   separate(Book_Tag,c("Book_Tag1","Book_Tag2", "Book_Tag3", "Book_Tag4",
                       "Book_Tag5", "Book_Tag6", "Book_Tag7",
                       "Book_Tag8","Book_Tag9"),sep=",")

```

To simplify the project I decided to look at only ya books. The reasoning behind this is that these book challenges are there to "protect the children", and that is why I didn't pick adult. At the same time if I chose young adult, there would be chance that I could get some spill over into the other two categories.
```{r}

ya_books <- books %>% filter(grepl('YoungAdult', Book_Tag))

```


Due to time contstraints I was only able to find 386 young adult books that weren't challenged to build the model, so I had to take a sample of the challenged ya books.
```{r}
set.seed(123)

ya_sample <- ya_books[sample(1:nrow(ya_books), 386), ]
```

breaking the challenged ya books tags into individual columns
```{r}

ya_sample <-ya_sample  %>% 
   separate(Book_Tag,c("Book_Tag1","Book_Tag2", "Book_Tag3", "Book_Tag4",
                       "Book_Tag5", "Book_Tag6", "Book_Tag7",
                       "Book_Tag8","Book_Tag9"),sep=",")

```

Creating a dataframe to look at the counts on individual tags in the the challenged ya books
```{r}
ya_tags <- test[,c(3:11)]
```

```{r}
sample_count <- table(unlist(ya_tags)); perc <- 100*count/sum(sample_count)
```

```{r}
sample_count <- as.data.frame(sample_count)
```

```{r}

sample_count <- sample_count[order(sample_count$Freq),]
```


```{r}
ya_sample <- ya_sample[,c(2,1,3:12)]
```

```{r}

colnames(books2)[1] = "Book_Title"

```

```{r}

colnames(ya_sample)[12] = "Challenged"

```

```{r}
book_data <- rbind(ya_sample, books2)
```


```{r}
book_data <- book_data[sample(1:nrow(book_data)), ]
```

I chose to look at how the top five tags for the challenged data would look like.
```{r}

book_data <- book_data %>%
  mutate(LGBT = case_when(Book_Tag1 == 'Lgbt' | 
                          Book_Tag2 == "Lgbt" | 
                          Book_Tag3 == 'Lgbt' | 
                          Book_Tag4 == "Lgbt" | 
                          Book_Tag5 == 'Lgbt' | 
                          Book_Tag6 == "Lgbt" | 
                          Book_Tag7 == 'Lgbt' | 
                          Book_Tag8 == "Lgbt" |
                          Book_Tag9 == "Lgbt"~1,
                          TRUE ~ 0))
```

```{r}

book_data <- book_data %>%
  mutate(Contemporary = case_when(Book_Tag1 == 'Contemporary' | 
                          Book_Tag2 == 'Contemporary' | 
                          Book_Tag3 == 'Contemporary' | 
                          Book_Tag4 == 'Contemporary' | 
                          Book_Tag5 == 'Contemporary' | 
                          Book_Tag6 == 'Contemporary' | 
                          Book_Tag7 == 'Contemporary' | 
                          Book_Tag8 == 'Contemporary' |
                          Book_Tag9 == 'Contemporary'~1,
                           TRUE ~ 0))
```

```{r}

book_data <- book_data %>%
  mutate(Romance = case_when(Book_Tag1 == 'Romance' | 
                             Book_Tag2 == 'Romance' | 
                             Book_Tag3 == 'Romance' | 
                             Book_Tag4 == 'Romance' | 
                             Book_Tag5 == 'Romance' | 
                             Book_Tag6 == 'Romance' | 
                             Book_Tag7 == 'Romance' | 
                             Book_Tag8 == 'Romance' |
                             Book_Tag9 == 'Romance'~1,
                           TRUE ~ 0))
```

```{r}

book_data <- book_data %>%
  mutate(Realistic_Fiction = case_when(Book_Tag1 == 'RealisticFiction' | 
                                       Book_Tag2 == 'RealisticFiction' | 
                                       Book_Tag3 == 'RealisticFiction' | 
                                       Book_Tag4 == 'RealisticFiction' | 
                                       Book_Tag5 == 'RealisticFiction' | 
                                       Book_Tag6 == 'RealisticFiction' | 
                                       Book_Tag7 == 'RealisticFiction' | 
                                       Book_Tag8 == 'RealisticFiction' |
                                       Book_Tag9 == 'RealisticFiction'~1,
                                       TRUE ~ 0))
```

```{r}

book_data <- book_data %>%
  mutate(Childrens = case_when(Book_Tag1 == 'Childrens' | 
                               Book_Tag2 == 'Childrens' | 
                               Book_Tag3 == 'Childrens' | 
                               Book_Tag4 == 'Childrens' | 
                               Book_Tag5 == 'Childrens' | 
                               Book_Tag6 == 'Childrens' | 
                               Book_Tag7 == 'Childrens' | 
                               Book_Tag8 == 'Childrens' |
                               Book_Tag9 == 'Childrens'~1,
                                       TRUE ~ 0))
```